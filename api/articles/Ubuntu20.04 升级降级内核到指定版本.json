{"title":"Ubuntu 20.04更新内核到指定版本","uid":"0d78162f6a007ff7b791112cb98b4193","slug":"Ubuntu20.04 升级降级内核到指定版本","date":"2022-03-28T08:40:40.000Z","updated":"2022-07-14T08:10:50.923Z","comments":true,"path":"api/articles/Ubuntu20.04 升级降级内核到指定版本.json","keywords":null,"cover":null,"content":"<p>记一次更新内核到5.8.0-33-generic</p>\n<span id=\"more\"></span>\n<h2 id=\"更新到指定版本\"><a href=\"#更新到指定版本\" class=\"headerlink\" title=\"更新到指定版本\"></a>更新到指定版本</h2><h3 id=\"查看当前版本\"><a href=\"#查看当前版本\" class=\"headerlink\" title=\"查看当前版本\"></a>查看当前版本</h3><pre><code class=\"shell\">$ uname -r\n4.15.0-101-generic\n\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 20.04 LTS\nRelease:        20.04\nCodename:       focal\n</code></pre>\n<h3 id=\"查看当前已经安装的-Kernel-Image\"><a href=\"#查看当前已经安装的-Kernel-Image\" class=\"headerlink\" title=\"查看当前已经安装的 Kernel Image\"></a>查看当前已经安装的 Kernel Image</h3><pre><code class=\"shell\">$ dpkg --get-selections |grep linux-image\nlinux-image-5.4.0-90-generic                    purge\nlinux-image-5.8.0-33-generic                    install\nlinux-image-generic                             install\n</code></pre>\n<h3 id=\"查询当前软件仓库可以安装的-Kernel-Image-版本，如果没有预期的版本，则需要额外配置仓库\"><a href=\"#查询当前软件仓库可以安装的-Kernel-Image-版本，如果没有预期的版本，则需要额外配置仓库\" class=\"headerlink\" title=\"查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库\"></a>查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库</h3><pre><code class=\"shell\">$ apt-cache search linux | grep linux-image\n</code></pre>\n<h3 id=\"安装指定版本的-Kernel-Image-和-Kernel-Header\"><a href=\"#安装指定版本的-Kernel-Image-和-Kernel-Header\" class=\"headerlink\" title=\"安装指定版本的 Kernel Image 和 Kernel Header\"></a>安装指定版本的 Kernel Image 和 Kernel Header</h3><pre><code class=\"shell\">$ sudo apt-get install linux-headers-5.8.0-33-generic linux-image-5.8.0-33-generic\n</code></pre>\n<h3 id=\"查看当前的Kernel列表\"><a href=\"#查看当前的Kernel列表\" class=\"headerlink\" title=\"查看当前的Kernel列表\"></a>查看当前的Kernel列表</h3><pre><code class=\"shell\">$ grep menuentry /boot/grub/grub.cfg\nif [ x\"${feature_menuentry_id}\" = xy ]; then\n  menuentry_id_option=\"--id\"\n  menuentry_id_option=\"\"\nexport menuentry_id_option\nmenuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\nsubmenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\n        menuentry 'Ubuntu, with Linux 5.8.0-33-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.8.0-33-generic-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\n        menuentry 'Ubuntu, with Linux 5.8.0-33-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.8.0-33-generic-recovery-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\n        menuentry 'Ubuntu, with Linux 5.4.0-90-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.4.0-90-generic-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\n        menuentry 'Ubuntu, with Linux 5.4.0-90-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.4.0-90-generic-recovery-b986dc3b-6b82-44d5-acb8-6cbad5e357d5' {\n</code></pre>\n<h3 id=\"修改-Kernel-的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改-grub-配置\"><a href=\"#修改-Kernel-的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改-grub-配置\" class=\"headerlink\" title=\"修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置\"></a>修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置</h3><pre><code class=\"shell\">$ sudo vim /etc/default/grub\n\n# GRUB_DEFAULT=0\nGRUB_DEFAULT=\"Advanced options for Ubuntu&gt;Ubuntu, with Linux 5.8.0-33-generic\"\n</code></pre>\n<h3 id=\"生效配置\"><a href=\"#生效配置\" class=\"headerlink\" title=\"生效配置\"></a>生效配置</h3><pre><code class=\"shell\">$ update-grub\n$ reboot\n</code></pre>\n<h2 id=\"删除不需要的Kernel\"><a href=\"#删除不需要的Kernel\" class=\"headerlink\" title=\"删除不需要的Kernel\"></a>删除不需要的Kernel</h2><h3 id=\"查询不包括当前内核版本的其它所有内核版本\"><a href=\"#查询不包括当前内核版本的其它所有内核版本\" class=\"headerlink\" title=\"查询不包括当前内核版本的其它所有内核版本\"></a>查询不包括当前内核版本的其它所有内核版本</h3><pre><code class=\"shell\">$ dpkg -l | tail -n +6| grep -E 'linux-image-[0-9]+'| grep -Fv $(uname -r)\npi  linux-image-5.4.0-90-generic         5.4.0-90.101                      amd64        Signed kernel image generic\n</code></pre>\n<p>Kernel 状态：</p>\n<ul>\n<li>rc：表示已经被移除</li>\n<li>ii：表示符合移除条件（可移除）</li>\n<li>iU：已进入 apt 安装队列，但还未被安装（不可移除）</li>\n</ul>\n<h3 id=\"删除指定的Kernel\"><a href=\"#删除指定的Kernel\" class=\"headerlink\" title=\"删除指定的Kernel\"></a>删除指定的Kernel</h3><pre><code class=\"shell\">dpkg --purge linux-image-5.4.0-90-generic\n</code></pre>\n","feature":true,"text":"记一次更新内核到5.8.0-33-generic 更新到指定版本查看当前版本$ uname -r 4.15.0-101-generic $ lsb_release -a No LSB modules are available. Distributor ID: Ubuntu De...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"Kernel","slug":"Kernel","count":1,"path":"api/tags/Kernel.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E6%96%B0%E5%88%B0%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">更新到指定版本</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">查看当前版本</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E7%9A%84-Kernel-Image\"><span class=\"toc-text\">查看当前已经安装的 Kernel Image</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93%E5%8F%AF%E4%BB%A5%E5%AE%89%E8%A3%85%E7%9A%84-Kernel-Image-%E7%89%88%E6%9C%AC%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E9%A2%84%E6%9C%9F%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8C%E5%88%99%E9%9C%80%E8%A6%81%E9%A2%9D%E5%A4%96%E9%85%8D%E7%BD%AE%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84-Kernel-Image-%E5%92%8C-Kernel-Header\"><span class=\"toc-text\">安装指定版本的 Kernel Image 和 Kernel Header</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%9A%84Kernel%E5%88%97%E8%A1%A8\"><span class=\"toc-text\">查看当前的Kernel列表</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9-Kernel-%E7%9A%84%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E7%9A%84%E6%98%AF%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8C%E9%82%A3%E4%B9%88%E9%BB%98%E8%AE%A4%E5%B0%B1%E6%98%AF%E9%A6%96%E9%80%89%E7%9A%84%EF%BC%9B%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E7%9A%84%E6%98%AF%E6%97%A7%E7%89%88%E6%9C%AC%EF%BC%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9-grub-%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%9F%E6%95%88%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">生效配置</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84Kernel\"><span class=\"toc-text\">删除不需要的Kernel</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E4%B8%8D%E5%8C%85%E6%8B%AC%E5%BD%93%E5%89%8D%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC%E7%9A%84%E5%85%B6%E5%AE%83%E6%89%80%E6%9C%89%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">查询不包括当前内核版本的其它所有内核版本</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9A%84Kernel\"><span class=\"toc-text\">删除指定的Kernel</span></a></li></ol></li></ol>","author":{"name":"L2ksy0d","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"PHPer","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"信安面试问题准备","uid":"aaa5e35c1756bb3cb6a307412db826fe","slug":"面试准备","date":"2022-03-24T16:00:00.000Z","updated":"2022-07-14T08:10:50.927Z","comments":true,"path":"api/articles/面试准备.json","keywords":null,"cover":[],"text":"收集一些常见的信息安全面试问题 信息收集假如给你一个网站你怎么去渗透信息收集 首先看是什么类型的网站，针对不同类型的网站有不同的信息搜集方案，如大型企业网站可以用天眼查，启信宝等查询法人股份等信息，小型网站可以查询使用了哪类建站系统 1.whois查詢,获取注册者邮箱姓名电话等。...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[],"tags":[{"name":"面经","slug":"面经","count":1,"path":"api/tags/面经.json"}],"author":{"name":"L2ksy0d","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"PHPer","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}